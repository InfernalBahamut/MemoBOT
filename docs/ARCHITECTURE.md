# Arquitectura del Bot de Recordatorios

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        BOT DE RECORDATORIOS                          โ
โ                            (Arquitectura)                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     bot_recordatorios.py (Main)                      โ
โ                                                                       โ
โ  - Punto de entrada de la aplicaciรณn                                โ
โ  - Orquestaciรณn de componentes                                      โ
โ  - Configuraciรณn de handlers de Telegram                            โ
โ  - Manejo del ciclo de vida de la aplicaciรณn                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                    โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ                           โ                            โ
        โผ                           โผ                            โผ
โโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโโโโ
โ  config.py   โ          โ  database.py     โ        โ gemini_service  โ
โ              โ          โ                  โ        โ      .py        โ
โ โข Config     โ          โ โข DatabaseMgr    โ        โ                 โ
โ   Class      โโโโโโโโโโโโ   - Pool         โ        โ โข GeminiService โ
โ              โ          โ   - CRUD Ops     โ        โ   - Parse       โ
โ โข .env vars  โ          โ   - Context Mgr  โ        โ   - Extract     โ
โ โข Validation โ          โ                  โ        โ   - Validate    โ
โโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโโโโ
                                    โฒ                            โฒ
                                    โ                            โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ                           โ
        โผ                           โ
โโโโโโโโโโโโโโโโโโโ                 โ
โ  scheduler.py   โ                 โ
โ                 โ                 โ
โ โข Reminder      โโโโโโโโโโโโโโโโโโโ
โ   Scheduler     โ
โ   - Thread      โ
โ   - Check DB    โ
โ   - Send Msg    โ
โโโโโโโโโโโโโโโโโโโ
        โฒ
        โ
        โ
        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        handlers.py                                 โ
โ                                                                     โ
โ  โข TelegramHandlers Class                                         โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ    โ  Comandos:                                               โ   โ
โ    โ  - /start      โ Bienvenida + botones                   โ   โ
โ    โ  - /listar     โ Ver recordatorios + botones            โ   โ
โ    โ  - /editar     โ Iniciar ediciรณn (ConversationHandler)  โ   โ
โ    โ  - /borrar     โ Eliminar recordatorio                  โ   โ
โ    โ  - /eliminar   โ Eliminar todos (con confirmaciรณn)      โ   โ
โ    โ  - /cancelar   โ Cancelar operaciรณn                     โ   โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ    โ  Callbacks:                                              โ   โ
โ    โ  - edit:ID     โ Botรณn editar                           โ   โ
โ    โ  - del:ID      โ Botรณn borrar                           โ   โ
โ    โ  - delall_*    โ Botones confirmaciรณn                   โ   โ
โ    โ  - listar      โ Botรณn listar                           โ   โ
โ    โ  - new_help    โ Botรณn ayuda                            โ   โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ    โ  Mensajes:                                               โ   โ
โ    โ  - Texto libre โ Crear recordatorio (usa Gemini)        โ   โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     FLUJO DE DATOS                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Usuario โ Telegram โ Handlers โ Gemini โ Database
                        โ                     โ
                     Response โโโโโโโโโ Scheduler
                        โ
                    Usuario


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  CAPA DE PERSISTENCIA                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  MySQL Database (recordatorios_db)                              โ
โ                                                                   โ
โ  Tabla: recordatorios                                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ โข id (PK)                                                 โ  โ
โ  โ โข chat_id         โ ID del usuario de Telegram           โ  โ
โ  โ โข tarea           โ Descripciรณn del recordatorio         โ  โ
โ  โ โข fecha_hora      โ Cuรกndo recordar                      โ  โ
โ  โ โข notificado      โ 0: Pendiente, 1: Enviado            โ  โ
โ  โ โข fecha_creacion  โ Timestamp creaciรณn                   โ  โ
โ  โ โข fecha_modificacion โ Timestamp รบltima modificaciรณn     โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                   โ
โ  รndices:                                                        โ
โ  โข idx_chat_notificado (chat_id, notificado)                   โ
โ  โข idx_fecha_notificado (fecha_hora, notificado)               โ
โ  โข idx_fecha_creacion (fecha_creacion)                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  SERVICIOS EXTERNOS                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโโโโโ
โ  Telegram API    โ        โ  Google Gemini   โ
โ                  โ        โ      API         โ
โ  โข Enviar msg    โ        โ                  โ
โ  โข Recibir cmd   โ        โ  โข Parse NLP     โ
โ  โข Botones       โ        โ  โข Extract JSON  โ
โโโโโโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  EJEMPLO DE FLUJO COMPLETO                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

1. Usuario envรญa: "Recordame comprar pan maรฑana a las 10"
   โ
   โผ
2. Telegram โ handlers.create_reminder()
   โ
   โผ
3. handlers โ gemini_service.parse_reminder()
   โ
   โผ
4. Gemini parsea y retorna:
   {tarea: "Comprar pan", fecha_hora: "2025-11-06 10:00:00"}
   โ
   โผ
5. handlers โ database.create_reminder()
   โ
   โผ
6. Database guarda y retorna ID: 42
   โ
   โผ
7. handlers โ Usuario: "ยกAgendado! (ID: 42)"
   โ
   โผ
8. [Tiempo pasa...]
   โ
   โผ
9. scheduler.check_and_send_reminders() (cada 10s)
   โ
   โผ
10. scheduler โ database.get_due_reminders()
    โ
    โผ
11. Database retorna: [(42, chat_id, "Comprar pan")]
    โ
    โผ
12. scheduler โ database.mark_as_notified([42])
    โ
    โผ
13. scheduler โ Telegram: "๐ RECORDATORIO: Comprar pan"
    โ
    โผ
14. Usuario recibe notificaciรณn โ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  PATRONES DE DISEรO UTILIZADOS                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โข Singleton Pattern         โ Config (รบnica instancia)
โข Factory Pattern           โ DatabaseManager (pool connections)
โข Strategy Pattern          โ GeminiService (parseo intercambiable)
โข Observer Pattern          โ Scheduler (observa base de datos)
โข Facade Pattern            โ Handlers (simplifica interfaz Telegram)
โข Context Manager Pattern   โ Database connections
โข Dependency Injection      โ Handlers recibe DB y Gemini
```
